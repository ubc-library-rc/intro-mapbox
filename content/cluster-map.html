<!DOCTYPE html>
<html>

<head>
    <title>Create and style clusters</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css' rel='stylesheet' />
</head>

<body>
    <div id='map' style='width: 700px; height: 600px; margin-left: 23%;'></div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoibGlseWRlbWV0IiwiYSI6ImNsYW82Z2t2NzB3aDMzcW50a3JodWw3bDIifQ.v7jgXFEaNMPGPsufwiL6qw'; //replace with your access token
        const map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/mapbox/streets-v11', // style URL try other styles from https://www.mapbox.com/gallery/
            center: [-123.11738086752482, 49.25090077610571], // starting position [lng, lat]
            zoom: 10.7, // starting zoom
            projection: 'globe' // display the map as a 3D globe
        });

        // Add zoom and rotation controls to the map.
        map.addControl(new mapboxgl.NavigationControl());


        map.on('load', () => {
            map.addSource('parks', {
                type: 'geojson',
                data: './data/van-parks.geojson',
                cluster: true,
                clusterMaxZoom: 14,
                clusterRadius: 50
            });

            map.addLayer({
                'id': 'park-markers',
                'type': 'circle',
                'source': 'parks',
                'filter': ['has', 'point_count'],
                'paint': {
                    'circle-color': '#008000',
                    'circle-radius': 14,
                    /*[
                        'step',
                        ['get', 'point_count'],
                        10,
                        80,
                        15,
                        216,
                        25
            
                    ],*/
                }
            });

            //display individual parks once zoomed in
            map.addLayer({
                id: 'unclustered-point',
                type: 'circle',
                source: 'parks',
                minzoom: 13.7,
                paint: {
                    'circle-color': '#f542da',
                    'circle-radius': 4,
                }
            });

            //add point count to cluster symbol 
            map.addLayer({
                id: 'cluster-count',
                type: 'symbol',
                source: 'parks',
                filter: ['has', 'point_count'],
                layout: {
                    'text-field': ['get', 'point_count_abbreviated'],
                    'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],
                    'text-size': 12
                },
                paint: {
                    'text-color': '#ffffff'
                }
            });

            map.on('click', 'unclustered-point', (e) => {
                const features = map.queryRenderedFeatures(e.point, {
                    layers: ['unclustered-point']
                });
                const name = features[0].properties.name;
                new mapboxgl.Popup(name)
                    .addTo(map);
            });








        });




    </script>

</body>

</html>